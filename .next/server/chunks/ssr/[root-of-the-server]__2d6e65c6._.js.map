{"version":3,"sources":["../../../../src/app/actions/user.ts","turbopack:///[project]/node_modules/openid-client/package.json","../../../../src/app/actions/chat.ts","../../../../.next-internal/server/app/invite/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { getServerSession } from \"next-auth/next\";\r\nimport { authOptions } from \"@/lib/auth\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\n// Obtiene el usuario real logueado a través de NextAuth\r\nexport async function getCurrentUser() {\r\n    try {\r\n        const session = await getServerSession(authOptions);\r\n\r\n        if (!session?.user?.email) {\r\n            return null;\r\n        }\r\n\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: session.user.email }\r\n        });\r\n\r\n        return user;\r\n    } catch (error) {\r\n        console.error('Error fetching current user session:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\n// Función para registrar nuevos usuarios\r\nexport async function registerUser(email: string, passwordRaw: string, name?: string) {\r\n    try {\r\n        // Validación básica\r\n        if (!email || !passwordRaw) {\r\n            return { success: false, message: 'El correo y la contraseña son obligatorios.' };\r\n        }\r\n\r\n        // Revisar si ya existe\r\n        const existing = await prisma.user.findUnique({ where: { email } });\r\n        if (existing) {\r\n            return { success: false, message: 'Ya existe una cuenta con este correo.' };\r\n        }\r\n\r\n        // Crear hash de la contraseña\r\n        const hashedPassword = await bcrypt.hash(passwordRaw, 10);\r\n\r\n        // Crear usuario\r\n        const user = await prisma.user.create({\r\n            data: {\r\n                email,\r\n                name: name || email.split('@')[0],\r\n                password: hashedPassword\r\n            }\r\n        });\r\n\r\n        return { success: true, message: 'Usuario creado exitosamente.' };\r\n    } catch (error: any) {\r\n        console.error('Error registrando usuario:', error);\r\n        return { success: false, message: error.message || 'Error desconocido creando el usuario.' };\r\n    }\r\n}\r\n","{\"name\":\"openid-client\",\"version\":\"5.7.1\",\"description\":\"OpenID Connect Relying Party (RP, Client) implementation for Node.js runtime, supports passportjs\",\"keywords\":[\"auth\",\"authentication\",\"basic\",\"certified\",\"client\",\"connect\",\"dynamic\",\"electron\",\"hybrid\",\"identity\",\"implicit\",\"oauth\",\"oauth2\",\"oidc\",\"openid\",\"passport\",\"relying party\",\"strategy\"],\"homepage\":\"https://github.com/panva/openid-client\",\"repository\":\"panva/openid-client\",\"funding\":{\"url\":\"https://github.com/sponsors/panva\"},\"license\":\"MIT\",\"author\":\"Filip Skokan <panva.ip@gmail.com>\",\"exports\":{\"types\":\"./types/index.d.ts\",\"import\":\"./lib/index.mjs\",\"require\":\"./lib/index.js\"},\"main\":\"./lib/index.js\",\"types\":\"./types/index.d.ts\",\"files\":[\"lib\",\"types/index.d.ts\"],\"scripts\":{\"format\":\"npx prettier --loglevel silent --write ./lib ./test ./certification ./types\",\"test\":\"mocha test/**/*.test.js\"},\"dependencies\":{\"jose\":\"^4.15.9\",\"lru-cache\":\"^6.0.0\",\"object-hash\":\"^2.2.0\",\"oidc-token-hash\":\"^5.0.3\"},\"devDependencies\":{\"@types/node\":\"^16.18.106\",\"@types/passport\":\"^1.0.16\",\"base64url\":\"^3.0.1\",\"chai\":\"^4.5.0\",\"mocha\":\"^10.7.3\",\"nock\":\"^13.5.5\",\"prettier\":\"^2.8.8\",\"readable-mock-req\":\"^0.2.2\",\"sinon\":\"^9.2.4\",\"timekeeper\":\"^2.3.1\"},\"standard-version\":{\"scripts\":{\"postchangelog\":\"sed -i '' -e 's/### \\\\[/## [/g' CHANGELOG.md\"},\"types\":[{\"type\":\"feat\",\"section\":\"Features\"},{\"type\":\"fix\",\"section\":\"Fixes\"},{\"type\":\"chore\",\"hidden\":true},{\"type\":\"docs\",\"hidden\":true},{\"type\":\"style\",\"hidden\":true},{\"type\":\"refactor\",\"section\":\"Refactor\",\"hidden\":false},{\"type\":\"perf\",\"section\":\"Performance\",\"hidden\":false},{\"type\":\"test\",\"hidden\":true}]}}","'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\n\r\nexport async function getOrCreateChatSession(workspaceId: string | null) {\r\n    try {\r\n        if (!workspaceId) {\r\n            // Un modo global sin workspace. Simplemente creamos una sesión anónima (o podríamos buscar una sin workspaceId)\r\n            const globalSession = await prisma.chatSession.findFirst({\r\n                where: { workspaceId: null }\r\n            });\r\n            if (globalSession) return globalSession;\r\n            return await prisma.chatSession.create({ data: {} });\r\n        }\r\n\r\n        // Buscar sesión activa para el workspace\r\n        let session = await prisma.chatSession.findFirst({\r\n            where: { workspaceId }\r\n        });\r\n\r\n        // Si no existe, crearla\r\n        if (!session) {\r\n            session = await prisma.chatSession.create({\r\n                data: { workspaceId }\r\n            });\r\n        }\r\n\r\n        return session;\r\n    } catch (error) {\r\n        console.error('Error getting/creating chat session:', error);\r\n        throw new Error('No se pudo obtener la sesión de chat');\r\n    }\r\n}\r\n\r\nexport async function getChatHistory(sessionId: string) {\r\n    try {\r\n        const messages = await prisma.chatMessage.findMany({\r\n            where: { chatSessionId: sessionId },\r\n            orderBy: { createdAt: 'asc' }\r\n        });\r\n        return messages;\r\n    } catch (error) {\r\n        console.error('Error fetching chat history:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function saveChatMessage(sessionId: string, role: string, text: string) {\r\n    try {\r\n        const message = await prisma.chatMessage.create({\r\n            data: {\r\n                chatSessionId: sessionId,\r\n                role,\r\n                text\r\n            }\r\n        });\r\n        return message;\r\n    } catch (error) {\r\n        console.error('Error saving chat message:', error);\r\n        throw new Error('No se pudo guardar el mensaje');\r\n    }\r\n}\r\n\r\nexport async function clearChatHistory(sessionId: string) {\r\n    try {\r\n        await prisma.chatMessage.deleteMany({\r\n            where: { chatSessionId: sessionId }\r\n        });\r\n        return true;\r\n    } catch (error) {\r\n        console.error('Error clearing chat history:', error);\r\n        throw new Error('No se pudo limpiar el historial');\r\n    }\r\n}\r\n","export {createWorkspace as '4057b6b122a1d227d93b4421561d1064d3daa794c6'} from 'ACTIONS_MODULE0'\nexport {updateWorkspace as '60aaccbf2e1157c6c321521724da79b6083afd2a63'} from 'ACTIONS_MODULE0'\nexport {deleteWorkspace as '4079e265df772b313e9fb1f8ed53ccc6c2f1755d2f'} from 'ACTIONS_MODULE0'\nexport {savePushSubscription as '405e0d830509c8d72682aaa3f5bf299d1a2d884845'} from 'ACTIONS_MODULE1'\nexport {getOrCreateChatSession as '40f7eb3235ad61d3222f3a251f463480ee8dcc84e3'} from 'ACTIONS_MODULE2'\nexport {getChatHistory as '40723cc56224262f28b87c25b6b494ea62369a007e'} from 'ACTIONS_MODULE2'\nexport {clearChatHistory as '40897aa8b4c0ae0f8aadab3d0c9582d0f8de82be30'} from 'ACTIONS_MODULE2'\nexport {getWorkspaces as '007df99478876faf1be0a9287652a497a9c330c5be'} from 'ACTIONS_MODULE0'\nexport {joinWorkspace as '40211ca8d3d05ab60a741dbbfd1c44d01ba208ee63'} from 'ACTIONS_MODULE0'\nexport {createWorkspace as '4057b6b122a1d227d93b4421561d1064d3daa794c6'} from 'ACTIONS_MODULE0'\nexport {deleteWorkspace as '4079e265df772b313e9fb1f8ed53ccc6c2f1755d2f'} from 'ACTIONS_MODULE0'\nexport {getWorkspaceMembers as '40808c801d7bd5372c066b27d49f0dbf04a5e56f80'} from 'ACTIONS_MODULE0'\nexport {inviteUserToWorkspace as '6096ab7f90edfbad42d79925c9b912f741ade35bd0'} from 'ACTIONS_MODULE0'\nexport {updateWorkspace as '60aaccbf2e1157c6c321521724da79b6083afd2a63'} from 'ACTIONS_MODULE0'\nexport {getCurrentUser as '00c5ec6a839333a2e817476cb0fa4602de37ccb213'} from 'ACTIONS_MODULE3'\nexport {registerUser as '70169935428d39f6a5198b3c84e3b133703d9dd938'} from 'ACTIONS_MODULE3'\n"],"names":[],"mappings":"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"}