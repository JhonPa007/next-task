module.exports=[69684,a=>{a.v({active:"Sidebar-module__XRNO5a__active",activeWs:"Sidebar-module__XRNO5a__activeWs",avatar:"Sidebar-module__XRNO5a__avatar",bottom:"Sidebar-module__XRNO5a__bottom",collapsed:"Sidebar-module__XRNO5a__collapsed",editingItem:"Sidebar-module__XRNO5a__editingItem",logo:"Sidebar-module__XRNO5a__logo",logoutBtn:"Sidebar-module__XRNO5a__logoutBtn",logoutBtnCollapsed:"Sidebar-module__XRNO5a__logoutBtnCollapsed",mobile:"Sidebar-module__XRNO5a__mobile",nav:"Sidebar-module__XRNO5a__nav",sidebar:"Sidebar-module__XRNO5a__sidebar",sidebarContent:"Sidebar-module__XRNO5a__sidebarContent",toggleBtn:"Sidebar-module__XRNO5a__toggleBtn",userInfo:"Sidebar-module__XRNO5a__userInfo",userName:"Sidebar-module__XRNO5a__userName",userSection:"Sidebar-module__XRNO5a__userSection",workspaceSelector:"Sidebar-module__XRNO5a__workspaceSelector",wsActions:"Sidebar-module__XRNO5a__wsActions",wsListItem:"Sidebar-module__XRNO5a__wsListItem"})},78040,a=>{a.v({backdrop:"SidebarLayout-module__UmuU3q__backdrop",contentCollapsed:"SidebarLayout-module__UmuU3q__contentCollapsed",contentMobile:"SidebarLayout-module__UmuU3q__contentMobile",fadeIn:"SidebarLayout-module__UmuU3q__fadeIn",layout:"SidebarLayout-module__UmuU3q__layout",mainContent:"SidebarLayout-module__UmuU3q__mainContent",mobileToggleBtn:"SidebarLayout-module__UmuU3q__mobileToggleBtn"})},67735,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(38246),f=a.i(75003),g=a.i(69684),h=a.i(5050);let i=(0,h.createServerReference)("4057b6b122a1d227d93b4421561d1064d3daa794c6",h.callServer,void 0,h.findSourceMapURL,"createWorkspace"),j=(0,h.createServerReference)("60aaccbf2e1157c6c321521724da79b6083afd2a63",h.callServer,void 0,h.findSourceMapURL,"updateWorkspace"),k=(0,h.createServerReference)("4079e265df772b313e9fb1f8ed53ccc6c2f1755d2f",h.callServer,void 0,h.findSourceMapURL,"deleteWorkspace");function l({initialWorkspaces:a}){let[f,h]=(0,c.useState)(a),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(""),t=(0,d.usePathname)(),u=(0,d.useRouter)(),v=async()=>{if(n.trim())try{let a=await i(n);h(b=>[a,...b]),o(""),m(!1)}catch(a){alert("Error creando el espacio de trabajo. ¬øEst√° conectada la BD?")}},w=async a=>{if(a.preventDefault(),r.trim()&&p)try{let a=await j(p,r);h(b=>b.map(b=>b.id===p?a:b)),q(null),s("")}catch(a){alert("Error al actualizar el workspace")}},x=async(a,b)=>{if(b.preventDefault(),confirm("¬øEst√°s seguro de eliminar este espacio de trabajo? Se borrar√°n todas sus metas."))try{await k(a),h(b=>b.filter(b=>b.id!==a)),t===`/workspace/${a}`&&u.push("/")}catch(a){alert("Error al eliminar el espacio de trabajo")}};return(0,b.jsxs)("div",{className:g.default.workspaceSelector,children:[(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,b.jsx)("span",{children:"Tus Espacios üëá"}),(0,b.jsx)("button",{onClick:()=>m(!l),style:{cursor:"pointer",background:"none",border:"none",color:"var(--primary)"},children:"+"})]}),l&&(0,b.jsxs)("div",{style:{display:"flex",gap:"5px",marginTop:"10px"},children:[(0,b.jsx)("input",{type:"text",value:n,onChange:a=>o(a.target.value),placeholder:"Nombre...",style:{width:"100%",padding:"4px",borderRadius:"4px",border:"1px solid #ddd"}}),(0,b.jsx)("button",{onClick:v,style:{padding:"4px 8px",background:"var(--primary)",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"‚úì"})]}),(0,b.jsx)("ul",{style:{listStyle:"none",padding:0},children:0===f.length?(0,b.jsx)("li",{children:"Sin espacios"}):f.map(a=>{let c=t===`/workspace/${a.id}`;return p===a.id?(0,b.jsxs)("li",{className:g.default.editingItem,style:{display:"flex",gap:"5px",padding:"0.5rem 0"},children:[(0,b.jsx)("input",{type:"text",value:r,onChange:a=>s(a.target.value),onKeyDown:a=>"Enter"===a.key&&w(a),style:{width:"100%",padding:"4px",borderRadius:"4px",border:"1px solid #ddd"},autoFocus:!0}),(0,b.jsx)("button",{onClick:w,style:{background:"none",border:"none",cursor:"pointer"},children:"‚úÖ"}),(0,b.jsx)("button",{onClick:()=>q(null),style:{background:"none",border:"none",cursor:"pointer"},children:"‚ùå"})]},a.id):(0,b.jsx)("li",{className:`${c?g.default.activeWs:""} ${g.default.wsListItem}`,children:(0,b.jsxs)(e.default,{href:`/workspace/${a.id}`,style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",textDecoration:"none",color:"inherit"},children:[(0,b.jsx)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a.name}),(0,b.jsxs)("div",{className:g.default.wsActions,children:[(0,b.jsx)("button",{onClick:b=>{b.preventDefault(),q(a.id),s(a.name)},title:"Renombrar",style:{background:"none",border:"none",cursor:"pointer",fontSize:"12px"},children:"‚úèÔ∏è"}),(0,b.jsx)("button",{onClick:b=>x(a.id,b),title:"Eliminar",style:{background:"none",border:"none",cursor:"pointer",fontSize:"12px"},children:"üóëÔ∏è"})]})]})},a.id)})})]})}let m=(0,h.createServerReference)("405e0d830509c8d72682aaa3f5bf299d1a2d884845",h.callServer,void 0,h.findSourceMapURL,"savePushSubscription");function n(){let[a,d]=(0,c.useState)(!1),[e,f]=(0,c.useState)(null),[g,h]=(0,c.useState)(""),[i,j]=(0,c.useState)(!1);(0,c.useEffect)(()=>{"serviceWorker"in navigator&&"PushManager"in window&&(d(!0),k())},[]);let k=async()=>{try{let a=await navigator.serviceWorker.getRegistration();if(a){let b=await a.pushManager.getSubscription();f(b)}}catch(a){console.error("Error checking sub",a)}},l=async()=>{j(!0),h("1/5: Verificando permisos...");try{let a=await Notification.requestPermission();if("granted"!==a){h("Error: Permiso denegado por el usuario."),j(!1);return}h("2/5: Obteniendo Service Worker...");let b=await navigator.serviceWorker.getRegistration();b||(h("2/5: Registrando Service Worker..."),await navigator.serviceWorker.register("/sw.js")),h("3/5: Esperando que el Service Worker est√© listo..."),b=await navigator.serviceWorker.ready,h("4/5: Obteniendo claves VAPID..."),h("5/6: Generando suscripci√≥n Push...");let c=await b.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(a){let b="=".repeat((4-a.length%4)%4),c=(a+b).replace(/\-/g,"+").replace(/_/g,"/"),d=window.atob(c),e=new Uint8Array(d.length);for(let a=0;a<d.length;++a)e[a]=d.charCodeAt(a);return e}("BPbZyq0xQWFJ2ZMXva0QcEGmzomeMpWkNUjvnPuTh66hbV6RmbBFrN7ffrk6nVm1OVDHxP2hwVfbXZrf0S8hES4")}),d=JSON.stringify(c),e=JSON.parse(d);h("6/6: Guardando en la base de datos...");let g=await m(e);g.success?(f(c),h("¬°Notificaciones Activadas!"),alert("¬°Suscripci√≥n exitosa!"),setTimeout(()=>h(""),3e3)):(h(`Error en BD: ${g.error}`),alert(`Error guardando en BD: ${g.error}`))}catch(a){console.error("Error in subscribeToPush:",a),h(`Denegado / Error: ${a.message}`),alert(`Error al suscribir: ${a.message}`)}j(!1)};return a?(0,b.jsxs)("div",{style:{padding:"1rem",borderTop:"1px solid var(--border-color)",marginTop:"auto"},children:[e?(0,b.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--status-ready)"},children:"‚úÖ Notificaciones Activadas"}):(0,b.jsx)("button",{onClick:l,style:{width:"100%",padding:"0.5rem",backgroundColor:"var(--primary)",color:"white",border:"none",borderRadius:"var(--radius-sm)",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:"Activar Alertas (Push)"}),g&&(0,b.jsx)("div",{style:{fontSize:"0.75rem",color:"gray",marginTop:"0.5rem"},children:g})]}):null}function o({initialWorkspaces:a=[],isCollapsed:c=!1,isMobile:h=!1,onToggle:i}){let j=(0,d.usePathname)(),{data:k}=(0,f.useSession)();return(0,b.jsxs)("aside",{className:`${g.default.sidebar} ${c?g.default.collapsed:""} ${h?g.default.mobile:""}`,children:[i&&(0,b.jsx)("button",{className:g.default.toggleBtn,onClick:i,title:c?"Mostrar Men√∫":"Ocultar Men√∫",children:c?"„Äã":"„Ää"}),(0,b.jsxs)("div",{className:g.default.sidebarContent,children:[(0,b.jsxs)("div",{className:g.default.logo,children:[(0,b.jsx)("span",{className:g.default.icon,children:"‚ö°"}),"NextTask"]}),(0,b.jsx)("nav",{className:g.default.nav,children:(0,b.jsxs)("ul",{children:[(0,b.jsx)(e.default,{href:"/",style:{textDecoration:"none"},children:(0,b.jsx)("li",{className:"/"===j?g.default.active:"",children:"Dashboard Global"})}),(0,b.jsx)(e.default,{href:"/my-tasks",style:{textDecoration:"none"},children:(0,b.jsx)("li",{className:"/my-tasks"===j?g.default.active:"",children:"Mis Tareas"})}),(0,b.jsx)(e.default,{href:"/reports",style:{textDecoration:"none"},children:(0,b.jsx)("li",{className:"/reports"===j?g.default.active:"",children:"Reportes"})})]})}),(0,b.jsx)(l,{initialWorkspaces:a}),(0,b.jsx)(n,{}),(0,b.jsxs)("div",{className:g.default.userSection,children:[!c&&k?.user&&(0,b.jsxs)("div",{className:g.default.userInfo,children:[(0,b.jsx)("div",{className:g.default.avatar,children:k.user.name?.charAt(0).toUpperCase()}),(0,b.jsx)("span",{className:g.default.userName,children:k.user.name})]}),(0,b.jsxs)("button",{className:`${g.default.logoutBtn} ${c?g.default.logoutBtnCollapsed:""}`,onClick:()=>(0,f.signOut)({callbackUrl:"/login"}),title:"Cerrar Sessi√≥n",children:["‚éã ",c?"":"Salir"]})]})]})]})}var p=a.i(78040);function q({children:a,initialWorkspaces:e}){let[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(!1),l=(0,d.usePathname)(),m="/login"===l||"/register"===l;return((0,c.useEffect)(()=>{k(!0);let a=()=>{let a=window.innerWidth<=768;i(a),a?g(!0):g(!1)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),(0,c.useEffect)(()=>{h&&!f&&g(!0)},[l]),m)?(0,b.jsx)(b.Fragment,{children:a}):(0,b.jsxs)("div",{className:p.default.layout,children:[j&&h&&!f&&(0,b.jsx)("div",{className:p.default.backdrop,onClick:()=>g(!0)}),(0,b.jsx)(o,{initialWorkspaces:e,isCollapsed:f,isMobile:h,onToggle:()=>g(!f)}),(0,b.jsx)("div",{className:`${p.default.mainContent} ${f?p.default.contentCollapsed:""} ${h?p.default.contentMobile:""}`,children:a})]})}a.s(["default",()=>q],67735)},34995,a=>{a.v({chatHeader:"FloatingChatbot-module__ZJnDPa__chatHeader",chatWindow:"FloatingChatbot-module__ZJnDPa__chatWindow",chatbotWrapper:"FloatingChatbot-module__ZJnDPa__chatbotWrapper",closeBtn:"FloatingChatbot-module__ZJnDPa__closeBtn",fabBtn:"FloatingChatbot-module__ZJnDPa__fabBtn",input:"FloatingChatbot-module__ZJnDPa__input",inputArea:"FloatingChatbot-module__ZJnDPa__inputArea",messagesArea:"FloatingChatbot-module__ZJnDPa__messagesArea",msgAi:"FloatingChatbot-module__ZJnDPa__msgAi",msgUser:"FloatingChatbot-module__ZJnDPa__msgUser",sendBtn:"FloatingChatbot-module__ZJnDPa__sendBtn"})},49674,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(34995),e=a.i(50944),f=a.i(5050);let g=(0,f.createServerReference)("40f7eb3235ad61d3222f3a251f463480ee8dcc84e3",f.callServer,void 0,f.findSourceMapURL,"getOrCreateChatSession"),h=(0,f.createServerReference)("40723cc56224262f28b87c25b6b494ea62369a007e",f.callServer,void 0,f.findSourceMapURL,"getChatHistory"),i=(0,f.createServerReference)("40897aa8b4c0ae0f8aadab3d0c9582d0f8de82be30",f.callServer,void 0,f.findSourceMapURL,"clearChatHistory");function j(){let[a,f]=(0,c.useState)(!1),[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(null),r=(0,e.usePathname)(),s=(0,e.useRouter)();if("/login"===r||"/register"===r)return null;let t=r&&r.includes("/workspace/")&&r.split("/").pop()||null;(0,c.useEffect)(()=>{let a=!0;return(async()=>{try{let b=await g(t);if(!a)return;q(b.id);let c=await h(b.id);if(!a)return;c&&c.length>0?k(c.map(a=>({role:a.role,text:a.text}))):k([{role:"model",text:"¬°Hola! Soy tu asistente de NextTask impulsado por Gemini. ¬øEn qu√© puedo ayudarte a organizar tu d√≠a?"}])}catch(b){console.error("Failed to load chat history",b),a&&k([{role:"model",text:"¬°Hola! Soy tu asistente de NextTask impulsado por Gemini. ¬øEn qu√© puedo ayudarte a organizar tu d√≠a?"}])}})(),()=>{a=!1}},[t]);let u=async()=>{if(!l.trim())return;let a=[...j,{role:"user",text:l.trim()}];k(a),m(""),o(!0);try{let b=null;t&&(b={workspaceId:t,workspaceName:"Workspace Actual"});let c=a.map(a=>({role:a.role,parts:[{text:a.text}]})),d=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:c,context:b,sessionId:p})}),e=await d.json();e.reply?(k(a=>[...a,{role:"model",text:e.reply}]),e.refreshRequired&&s.refresh()):k(a=>[...a,{role:"model",text:"Lo siento, tuve un problema al procesar eso."}])}catch(a){k(a=>[...a,{role:"model",text:"Error de conexi√≥n temporal."}])}finally{o(!1)}},v=async()=>{if(p){o(!0);try{await i(p),k([{role:"model",text:"¬°Hola! He limpiado nuestra conversaci√≥n. ¬øEn qu√© puedo ayudarte a organizar tu d√≠a?"}])}catch(a){console.error("No se pudo limpiar el chat",a)}finally{o(!1)}}};return"/login"===r||"/register"===r?null:(0,b.jsxs)("div",{className:d.default.chatbotWrapper,children:[a&&(0,b.jsxs)("div",{className:d.default.chatWindow,children:[(0,b.jsxs)("div",{className:d.default.chatHeader,children:[(0,b.jsx)("span",{style:{fontWeight:600},children:"‚ú® Gemini AI"}),(0,b.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,b.jsx)("button",{onClick:v,title:"Limpiar Conversaci√≥n",className:d.default.iconBtn,children:"üóëÔ∏è"}),(0,b.jsx)("button",{onClick:()=>f(!1),className:d.default.closeBtn,children:"√ó"})]})]}),(0,b.jsxs)("div",{className:d.default.messagesArea,children:[j.map((a,c)=>(0,b.jsx)("div",{className:"model"===a.role?d.default.msgAi:d.default.msgUser,children:a.text},c)),n&&(0,b.jsx)("div",{className:d.default.msgAi,children:"Pensando..."})]}),(0,b.jsxs)("div",{className:d.default.inputArea,children:[(0,b.jsx)("input",{type:"text",placeholder:"Preg√∫ntale a Gemini...",value:l,onChange:a=>m(a.target.value),onKeyDown:a=>"Enter"===a.key&&u(),className:d.default.input}),(0,b.jsx)("button",{onClick:u,disabled:n,className:d.default.sendBtn,children:n?"...":"‚û§"})]})]}),!a&&(0,b.jsx)("button",{className:d.default.fabBtn,onClick:()=>f(!0),children:"‚ú® Asistente IA"})]})}a.s(["default",()=>j],49674)},91956,a=>{"use strict";var b=a.i(87924),c=a.i(75003);function d({children:a}){return(0,b.jsx)(c.SessionProvider,{children:a})}a.s(["default",()=>d])}];

//# sourceMappingURL=src_components_c6b35f1f._.js.map