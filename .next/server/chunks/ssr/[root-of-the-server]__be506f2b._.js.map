{"version":3,"sources":["turbopack:///[project]/node_modules/openid-client/package.json","../../../../src/app/actions/user.ts"],"sourcesContent":["{\"name\":\"openid-client\",\"version\":\"5.7.1\",\"description\":\"OpenID Connect Relying Party (RP, Client) implementation for Node.js runtime, supports passportjs\",\"keywords\":[\"auth\",\"authentication\",\"basic\",\"certified\",\"client\",\"connect\",\"dynamic\",\"electron\",\"hybrid\",\"identity\",\"implicit\",\"oauth\",\"oauth2\",\"oidc\",\"openid\",\"passport\",\"relying party\",\"strategy\"],\"homepage\":\"https://github.com/panva/openid-client\",\"repository\":\"panva/openid-client\",\"funding\":{\"url\":\"https://github.com/sponsors/panva\"},\"license\":\"MIT\",\"author\":\"Filip Skokan <panva.ip@gmail.com>\",\"exports\":{\"types\":\"./types/index.d.ts\",\"import\":\"./lib/index.mjs\",\"require\":\"./lib/index.js\"},\"main\":\"./lib/index.js\",\"types\":\"./types/index.d.ts\",\"files\":[\"lib\",\"types/index.d.ts\"],\"scripts\":{\"format\":\"npx prettier --loglevel silent --write ./lib ./test ./certification ./types\",\"test\":\"mocha test/**/*.test.js\"},\"dependencies\":{\"jose\":\"^4.15.9\",\"lru-cache\":\"^6.0.0\",\"object-hash\":\"^2.2.0\",\"oidc-token-hash\":\"^5.0.3\"},\"devDependencies\":{\"@types/node\":\"^16.18.106\",\"@types/passport\":\"^1.0.16\",\"base64url\":\"^3.0.1\",\"chai\":\"^4.5.0\",\"mocha\":\"^10.7.3\",\"nock\":\"^13.5.5\",\"prettier\":\"^2.8.8\",\"readable-mock-req\":\"^0.2.2\",\"sinon\":\"^9.2.4\",\"timekeeper\":\"^2.3.1\"},\"standard-version\":{\"scripts\":{\"postchangelog\":\"sed -i '' -e 's/### \\\\[/## [/g' CHANGELOG.md\"},\"types\":[{\"type\":\"feat\",\"section\":\"Features\"},{\"type\":\"fix\",\"section\":\"Fixes\"},{\"type\":\"chore\",\"hidden\":true},{\"type\":\"docs\",\"hidden\":true},{\"type\":\"style\",\"hidden\":true},{\"type\":\"refactor\",\"section\":\"Refactor\",\"hidden\":false},{\"type\":\"perf\",\"section\":\"Performance\",\"hidden\":false},{\"type\":\"test\",\"hidden\":true}]}}","'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { getServerSession } from \"next-auth/next\";\r\nimport { authOptions } from \"@/lib/auth\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\n// Obtiene el usuario real logueado a través de NextAuth\r\nexport async function getCurrentUser() {\r\n    try {\r\n        const session = await getServerSession(authOptions);\r\n\r\n        if (!session?.user?.email) {\r\n            return null;\r\n        }\r\n\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: session.user.email }\r\n        });\r\n\r\n        return user;\r\n    } catch (error) {\r\n        console.error('Error fetching current user session:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\n// Función para registrar nuevos usuarios\r\nexport async function registerUser(email: string, passwordRaw: string, name?: string) {\r\n    try {\r\n        // Validación básica\r\n        if (!email || !passwordRaw) {\r\n            return { success: false, message: 'El correo y la contraseña son obligatorios.' };\r\n        }\r\n\r\n        // Revisar si ya existe\r\n        const existing = await prisma.user.findUnique({ where: { email } });\r\n        if (existing) {\r\n            return { success: false, message: 'Ya existe una cuenta con este correo.' };\r\n        }\r\n\r\n        // Crear hash de la contraseña\r\n        const hashedPassword = await bcrypt.hash(passwordRaw, 10);\r\n\r\n        // Crear usuario\r\n        const user = await prisma.user.create({\r\n            data: {\r\n                email,\r\n                name: name || email.split('@')[0],\r\n                password: hashedPassword\r\n            }\r\n        });\r\n\r\n        return { success: true, message: 'Usuario creado exitosamente.' };\r\n    } catch (error: any) {\r\n        console.error('Error registrando usuario:', error);\r\n        return { success: false, message: error.message || 'Error desconocido creando el usuario.' };\r\n    }\r\n}\r\n"],"names":[],"mappings":"wkBAAA,EAAA,CAAA,CAAA,CAAA,KAAA,gBAAA,QAAA,QAAA,YAAA,oGAAA,SAAA,CAAA,OAAA,iBAAA,QAAA,YAAA,SAAA,UAAA,UAAA,WAAA,SAAA,WAAA,WAAA,QAAA,SAAA,OAAA,SAAA,WAAA,gBAAA,WAAA,CAAA,SAAA,yCAAA,WAAA,sBAAA,QAAA,CAAA,IAAA,mCAAA,EAAA,QAAA,MAAA,OAAA,oCAAA,QAAA,CAAA,MAAA,qBAAA,OAAA,kBAAA,QAAA,gBAAA,EAAA,KAAA,iBAAA,MAAA,qBAAA,MAAA,CAAA,MAAA,mBAAA,CAAA,QAAA,CAAA,OAAA,8EAAA,KAAA,yBAAA,EAAA,aAAA,CAAA,KAAA,UAAA,YAAA,SAAA,cAAA,SAAA,kBAAA,QAAA,EAAA,gBAAA,CAAA,cAAA,aAAA,kBAAA,UAAA,UAAA,SAAA,KAAA,SAAA,MAAA,UAAA,KAAA,UAAA,SAAA,SAAA,oBAAA,SAAA,MAAA,SAAA,WAAA,QAAA,EAAA,mBAAA,CAAA,QAAA,CAAA,cAAA,8CAAA,EAAA,MAAA,CAAA,CAAA,KAAA,OAAA,QAAA,UAAA,EAAA,CAAA,KAAA,MAAA,QAAA,OAAA,EAAA,CAAA,KAAA,QAAA,OAAA,CAAA,CAAA,EAAA,CAAA,KAAA,OAAA,OAAA,CAAA,CAAA,EAAA,CAAA,KAAA,QAAA,OAAA,CAAA,CAAA,EAAA,CAAA,KAAA,WAAA,QAAA,WAAA,OAAA,CAAA,CAAA,EAAA,CAAA,KAAA,OAAA,QAAA,cAAA,OAAA,CAAA,CAAA,EAAA,CAAA,KAAA,OAAA,OAAA,CAAA,CAAA,EAAA,CAAA,E,0CCEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OAGO,eAAe,IAClB,GAAI,CACA,IAAM,EAAU,MAAM,CAAA,EAAA,EAAA,gBAAA,AAAgB,EAAC,EAAA,WAAW,EAElD,GAAI,CAAC,GAAS,MAAM,MAChB,CADuB,MAChB,KAOX,OAAO,AAJM,MAAM,EAAA,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CACtC,MAAO,CAAE,MAAO,EAAQ,IAAI,CAAC,KAAK,AAAC,CACvC,EAGJ,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,uCAAwC,GAC/C,IACX,CACJ,CAGO,eAAe,EAAa,CAAa,CAAE,CAAmB,CAAE,CAAa,EAChF,GAAI,CAEA,GAAI,CAAC,GAAS,CAAC,EACX,MAAO,CAAE,IADe,KACN,EAAO,QAAS,6CAA8C,EAKpF,GADiB,CACb,KADmB,EAAA,GACT,GADe,CAAC,IAAI,CAAC,UAAU,CAAC,CAAE,MAAO,OAAE,CAAM,CAAE,GAE7D,MAAO,CAAE,SAAS,EAAO,QAAS,uCAAwC,EAI9E,IAAM,EAAiB,MAAM,EAAA,OAAM,CAAC,IAAI,CAAC,EAAa,IAWtD,OARa,MAAM,EAAA,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAClC,KAAM,OACF,EACA,KAAM,GAAQ,EAAM,KAAK,CAAC,IAAI,CAAC,EAAE,CACjC,SAAU,CACd,CACJ,GAEO,CAAE,SAAS,EAAM,QAAS,8BAA+B,CACpE,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,6BAA8B,GACrC,CAAE,SAAS,EAAO,QAAS,EAAM,OAAO,EAAI,uCAAwC,CAC/F,CACJ,0CAlDsB,EAoBA,IApBA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAoBA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA"}