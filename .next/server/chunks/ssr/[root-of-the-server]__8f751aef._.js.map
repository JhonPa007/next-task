{"version":3,"sources":["../../../../src/app/actions/user.ts","../../../../src/app/actions/chat.ts","../../../../.next-internal/server/app/_not-found/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\n\r\n// Mock Auth: Returns the first user in the database or creates one if none exists.\r\nexport async function getCurrentUser() {\r\n    try {\r\n        let user = await prisma.user.findFirst();\r\n\r\n        if (!user) {\r\n            user = await prisma.user.create({\r\n                data: {\r\n                    email: 'admin@nexttask.com',\r\n                    name: 'Admin User'\r\n                }\r\n            });\r\n        }\r\n\r\n        return user;\r\n    } catch (error) {\r\n        console.error('Error fetching current user:', error);\r\n        return null; // En caso de fallo crítico de base de datos\r\n    }\r\n}\r\n","'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\n\r\nexport async function getOrCreateChatSession(workspaceId: string | null) {\r\n    try {\r\n        if (!workspaceId) {\r\n            // Un modo global sin workspace. Simplemente creamos una sesión anónima (o podríamos buscar una sin workspaceId)\r\n            const globalSession = await prisma.chatSession.findFirst({\r\n                where: { workspaceId: null }\r\n            });\r\n            if (globalSession) return globalSession;\r\n            return await prisma.chatSession.create({ data: {} });\r\n        }\r\n\r\n        // Buscar sesión activa para el workspace\r\n        let session = await prisma.chatSession.findFirst({\r\n            where: { workspaceId }\r\n        });\r\n\r\n        // Si no existe, crearla\r\n        if (!session) {\r\n            session = await prisma.chatSession.create({\r\n                data: { workspaceId }\r\n            });\r\n        }\r\n\r\n        return session;\r\n    } catch (error) {\r\n        console.error('Error getting/creating chat session:', error);\r\n        throw new Error('No se pudo obtener la sesión de chat');\r\n    }\r\n}\r\n\r\nexport async function getChatHistory(sessionId: string) {\r\n    try {\r\n        const messages = await prisma.chatMessage.findMany({\r\n            where: { chatSessionId: sessionId },\r\n            orderBy: { createdAt: 'asc' }\r\n        });\r\n        return messages;\r\n    } catch (error) {\r\n        console.error('Error fetching chat history:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function saveChatMessage(sessionId: string, role: string, text: string) {\r\n    try {\r\n        const message = await prisma.chatMessage.create({\r\n            data: {\r\n                chatSessionId: sessionId,\r\n                role,\r\n                text\r\n            }\r\n        });\r\n        return message;\r\n    } catch (error) {\r\n        console.error('Error saving chat message:', error);\r\n        throw new Error('No se pudo guardar el mensaje');\r\n    }\r\n}\r\n\r\nexport async function clearChatHistory(sessionId: string) {\r\n    try {\r\n        await prisma.chatMessage.deleteMany({\r\n            where: { chatSessionId: sessionId }\r\n        });\r\n        return true;\r\n    } catch (error) {\r\n        console.error('Error clearing chat history:', error);\r\n        throw new Error('No se pudo limpiar el historial');\r\n    }\r\n}\r\n","export {createWorkspace as '4057b6b122a1d227d93b4421561d1064d3daa794c6'} from 'ACTIONS_MODULE0'\nexport {updateWorkspace as '60aaccbf2e1157c6c321521724da79b6083afd2a63'} from 'ACTIONS_MODULE0'\nexport {deleteWorkspace as '4079e265df772b313e9fb1f8ed53ccc6c2f1755d2f'} from 'ACTIONS_MODULE0'\nexport {savePushSubscription as '405e0d830509c8d72682aaa3f5bf299d1a2d884845'} from 'ACTIONS_MODULE1'\nexport {getOrCreateChatSession as '40f7eb3235ad61d3222f3a251f463480ee8dcc84e3'} from 'ACTIONS_MODULE2'\nexport {getChatHistory as '40723cc56224262f28b87c25b6b494ea62369a007e'} from 'ACTIONS_MODULE2'\nexport {clearChatHistory as '40897aa8b4c0ae0f8aadab3d0c9582d0f8de82be30'} from 'ACTIONS_MODULE2'\nexport {getWorkspaces as '007df99478876faf1be0a9287652a497a9c330c5be'} from 'ACTIONS_MODULE0'\nexport {createWorkspace as '4057b6b122a1d227d93b4421561d1064d3daa794c6'} from 'ACTIONS_MODULE0'\nexport {deleteWorkspace as '4079e265df772b313e9fb1f8ed53ccc6c2f1755d2f'} from 'ACTIONS_MODULE0'\nexport {getWorkspaceMembers as '40808c801d7bd5372c066b27d49f0dbf04a5e56f80'} from 'ACTIONS_MODULE0'\nexport {inviteUserToWorkspace as '6096ab7f90edfbad42d79925c9b912f741ade35bd0'} from 'ACTIONS_MODULE0'\nexport {updateWorkspace as '60aaccbf2e1157c6c321521724da79b6083afd2a63'} from 'ACTIONS_MODULE0'\nexport {getCurrentUser as '00c5ec6a839333a2e817476cb0fa4602de37ccb213'} from 'ACTIONS_MODULE3'\n"],"names":[],"mappings":"osBAEA,EAAA,EAAA,CAAA,CAAA,OAGO,eAAe,IAClB,GAAI,CACA,IAAI,EAAO,MAAM,EAAA,MAAM,CAAC,IAAI,CAAC,SAAS,GAWtC,OATI,AAAC,IACD,EADO,AACA,MAAM,EAAA,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAC5B,KAAM,CACF,MAAO,qBACP,KAAM,YACV,CACJ,EAAA,EAGG,CACX,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,+BAAgC,GACvC,IACX,CACJ,CAFqB,yCAhBC,GAgB2C,CAhB3C,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,6ECHtB,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,EAAuB,CAA0B,EACnE,GAAI,CACA,GAAI,CAAC,EAAa,CAEd,IAAM,EAAgB,MAAM,EAAA,MAAM,CAAC,WAAW,CAAC,SAAS,CAAC,CACrD,MAAO,CAAE,YAAa,IAAK,CAC/B,GACA,GAAI,EAAe,OAAO,EAC1B,OAAO,MAAM,EAAA,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAE,KAAM,CAAC,CAAE,EACtD,CAGA,IAAI,EAAU,MAAM,EAAA,MAAM,CAAC,WAAW,CAAC,SAAS,CAAC,CAC7C,MAAO,aAAE,CAAY,CACzB,GASA,OANI,AAAC,IACD,EAAU,GADA,GACM,EAAA,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CACtC,KAAM,aAAE,CAAY,CACxB,EAAA,EAGG,CACX,CAAE,MAAO,EAAO,CAEZ,MADA,QAAQ,KAAK,CAAC,uCAAwC,GAChD,AAAI,MAAM,uCACpB,CACJ,CAEO,eAAe,EAAe,CAAiB,EAClD,GAAI,CAKA,OAJiB,AAIV,MAJgB,EAAA,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,CAC/C,MAAO,CAAE,cAAe,CAAU,EAClC,QAAS,CAAE,UAAW,KAAM,CAChC,EAEJ,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,+BAAgC,GACvC,EAAE,AACb,CACJ,CAEO,eAAe,EAAgB,CAAiB,CAAE,CAAY,CAAE,CAAY,EAC/E,GAAI,CAQA,OAPgB,AAOT,MAPe,EAAA,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAC5C,KAAM,CACF,cAAe,OACf,OACA,CACJ,CACJ,EAEJ,CAAE,MAAO,EAAO,CAEZ,MADA,QAAQ,KAAK,CAAC,6BAA8B,GAClC,AAAJ,MAAU,gCACpB,CACJ,CAEO,eAAe,EAAiB,CAAiB,EACpD,GAAI,CAIA,OAHA,MAAM,EAAA,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,CAChC,MAAO,CAAE,cAAe,CAAU,CACtC,IACO,CACX,CAAE,MAAO,EAAO,CAEZ,MADA,QAAQ,KAAK,CAAC,+BAAgC,GACpC,AAAJ,MAAU,kCACpB,CACJ,0CArEsB,EA8BA,EAaA,EAgBA,IA3DA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MA8BA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAaA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAgBA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,oHC/DtB,IAAA,EAAA,EAAA,CAAA,CAAA,OAGA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OASA,EAAA,EAAA,CAAA,CAAA"}