(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return r}});let r=e=>{}},18566,(e,t,a)=>{t.exports=e.r(76562)},65150,e=>{"use strict";var t=e.i(43476),a=e.i(71645);let r=(0,a.createContext)(void 0);function o({children:e}){let[o,i]=(0,a.useState)("light"),[n,l]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{l(!0);let e=localStorage.getItem("theme");e?(i(e),document.documentElement.setAttribute("data-theme",e)):window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?(i("dark"),document.documentElement.setAttribute("data-theme","dark")):document.documentElement.setAttribute("data-theme","light")},[]),n)?(0,t.jsx)(r.Provider,{value:{theme:o,toggleTheme:()=>{let e="light"===o?"dark":"light";i(e),localStorage.setItem("theme",e),document.documentElement.setAttribute("data-theme",e)}},children:e}):(0,t.jsx)("div",{style:{visibility:"hidden"},children:e})}function i(){let e=(0,a.useContext)(r);return void 0===e?{theme:"light",toggleTheme:()=>{}}:e}e.s(["ThemeProvider",()=>o,"useTheme",()=>i])},95187,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r={callServer:function(){return i.callServer},createServerReference:function(){return l.createServerReference},findSourceMapURL:function(){return n.findSourceMapURL}};for(var o in r)Object.defineProperty(a,o,{enumerable:!0,get:r[o]});let i=e.r(32120),n=e.r(92245),l=e.r(35326)},30051,e=>{e.v({active:"Sidebar-module__XRNO5a__active",activeWs:"Sidebar-module__XRNO5a__activeWs",avatar:"Sidebar-module__XRNO5a__avatar",bottom:"Sidebar-module__XRNO5a__bottom",collapsed:"Sidebar-module__XRNO5a__collapsed",editingItem:"Sidebar-module__XRNO5a__editingItem",logo:"Sidebar-module__XRNO5a__logo",logoutBtn:"Sidebar-module__XRNO5a__logoutBtn",logoutBtnCollapsed:"Sidebar-module__XRNO5a__logoutBtnCollapsed",mobile:"Sidebar-module__XRNO5a__mobile",nav:"Sidebar-module__XRNO5a__nav",sidebar:"Sidebar-module__XRNO5a__sidebar",sidebarContent:"Sidebar-module__XRNO5a__sidebarContent",toggleBtn:"Sidebar-module__XRNO5a__toggleBtn",userInfo:"Sidebar-module__XRNO5a__userInfo",userName:"Sidebar-module__XRNO5a__userName",userSection:"Sidebar-module__XRNO5a__userSection",workspaceSelector:"Sidebar-module__XRNO5a__workspaceSelector",wsActions:"Sidebar-module__XRNO5a__wsActions",wsListItem:"Sidebar-module__XRNO5a__wsListItem"})},67874,e=>{e.v({backdrop:"SidebarLayout-module__UmuU3q__backdrop",contentCollapsed:"SidebarLayout-module__UmuU3q__contentCollapsed",contentMobile:"SidebarLayout-module__UmuU3q__contentMobile",fadeIn:"SidebarLayout-module__UmuU3q__fadeIn",layout:"SidebarLayout-module__UmuU3q__layout",mainContent:"SidebarLayout-module__UmuU3q__mainContent",mobileToggleBtn:"SidebarLayout-module__UmuU3q__mobileToggleBtn"})},9796,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(18566),o=e.i(22016),i=e.i(17255),n=e.i(30051),l=e.i(95187);let s=(0,l.createServerReference)("4057b6b122a1d227d93b4421561d1064d3daa794c6",l.callServer,void 0,l.findSourceMapURL,"createWorkspace"),d=(0,l.createServerReference)("60aaccbf2e1157c6c321521724da79b6083afd2a63",l.callServer,void 0,l.findSourceMapURL,"updateWorkspace"),c=(0,l.createServerReference)("4079e265df772b313e9fb1f8ed53ccc6c2f1755d2f",l.callServer,void 0,l.findSourceMapURL,"deleteWorkspace");function u({initialWorkspaces:e}){let[i,l]=(0,a.useState)(e),[u,m]=(0,a.useState)(!1),[p,f]=(0,a.useState)(""),[h,b]=(0,a.useState)(null),[_,g]=(0,a.useState)(""),v=(0,r.usePathname)(),x=(0,r.useRouter)(),S=async()=>{if(p.trim())try{let e=await s(p);l(t=>[e,...t]),f(""),m(!1)}catch(e){alert("Error creando el espacio de trabajo. ¬øEst√° conectada la BD?")}},y=async e=>{if(e.preventDefault(),_.trim()&&h)try{let e=await d(h,_);l(t=>t.map(t=>t.id===h?e:t)),b(null),g("")}catch(e){alert("Error al actualizar el workspace")}},j=async(e,t)=>{if(t.preventDefault(),confirm("¬øEst√°s seguro de eliminar este espacio de trabajo? Se borrar√°n todas sus metas."))try{await c(e),l(t=>t.filter(t=>t.id!==e)),v===`/workspace/${e}`&&x.push("/")}catch(e){alert("Error al eliminar el espacio de trabajo")}};return(0,t.jsxs)("div",{className:n.default.workspaceSelector,children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,t.jsx)("span",{children:"Tus Espacios üëá"}),(0,t.jsx)("button",{onClick:()=>m(!u),style:{cursor:"pointer",background:"none",border:"none",color:"var(--primary)"},children:"+"})]}),u&&(0,t.jsxs)("div",{style:{display:"flex",gap:"5px",marginTop:"10px"},children:[(0,t.jsx)("input",{type:"text",value:p,onChange:e=>f(e.target.value),placeholder:"Nombre...",style:{width:"100%",padding:"4px",borderRadius:"4px",border:"1px solid #ddd"}}),(0,t.jsx)("button",{onClick:S,style:{padding:"4px 8px",background:"var(--primary)",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"‚úì"})]}),(0,t.jsx)("ul",{style:{listStyle:"none",padding:0},children:0===i.length?(0,t.jsx)("li",{children:"Sin espacios"}):i.map(e=>{let a=v===`/workspace/${e.id}`;return h===e.id?(0,t.jsxs)("li",{className:n.default.editingItem,style:{display:"flex",gap:"5px",padding:"0.5rem 0"},children:[(0,t.jsx)("input",{type:"text",value:_,onChange:e=>g(e.target.value),onKeyDown:e=>"Enter"===e.key&&y(e),style:{width:"100%",padding:"4px",borderRadius:"4px",border:"1px solid #ddd"},autoFocus:!0}),(0,t.jsx)("button",{onClick:y,style:{background:"none",border:"none",cursor:"pointer"},children:"‚úÖ"}),(0,t.jsx)("button",{onClick:()=>b(null),style:{background:"none",border:"none",cursor:"pointer"},children:"‚ùå"})]},e.id):(0,t.jsx)("li",{className:`${a?n.default.activeWs:""} ${n.default.wsListItem}`,children:(0,t.jsxs)(o.default,{href:`/workspace/${e.id}`,style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",textDecoration:"none",color:"inherit"},children:[(0,t.jsx)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name}),(0,t.jsxs)("div",{className:n.default.wsActions,children:[(0,t.jsx)("button",{onClick:t=>{t.preventDefault(),b(e.id),g(e.name)},title:"Renombrar",style:{background:"none",border:"none",cursor:"pointer",fontSize:"12px"},children:"‚úèÔ∏è"}),(0,t.jsx)("button",{onClick:t=>j(e.id,t),title:"Eliminar",style:{background:"none",border:"none",cursor:"pointer",fontSize:"12px"},children:"üóëÔ∏è"})]})]})},e.id)})})]})}e.i(47167);let m=(0,l.createServerReference)("405e0d830509c8d72682aaa3f5bf299d1a2d884845",l.callServer,void 0,l.findSourceMapURL,"savePushSubscription");function p(){let[e,r]=(0,a.useState)(!1),[o,i]=(0,a.useState)(null),[n,l]=(0,a.useState)(""),[s,d]=(0,a.useState)(!1);(0,a.useEffect)(()=>{"serviceWorker"in navigator&&"PushManager"in window&&(r(!0),c())},[]);let c=async()=>{try{let e=await navigator.serviceWorker.getRegistration();if(e){let t=await e.pushManager.getSubscription();i(t)}}catch(e){console.error("Error checking sub",e)}},u=async()=>{d(!0),l("1/5: Verificando permisos...");try{let e=await Notification.requestPermission();if("granted"!==e){l("Error: Permiso denegado por el usuario."),d(!1);return}l("2/5: Obteniendo Service Worker...");let t=await navigator.serviceWorker.getRegistration();t||(l("2/5: Registrando Service Worker..."),await navigator.serviceWorker.register("/sw.js")),l("3/5: Esperando que el Service Worker est√© listo..."),t=await navigator.serviceWorker.ready,l("4/5: Obteniendo claves VAPID..."),l("5/6: Generando suscripci√≥n Push...");let a=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){let t="=".repeat((4-e.length%4)%4),a=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),r=window.atob(a),o=new Uint8Array(r.length);for(let e=0;e<r.length;++e)o[e]=r.charCodeAt(e);return o}("BPbZyq0xQWFJ2ZMXva0QcEGmzomeMpWkNUjvnPuTh66hbV6RmbBFrN7ffrk6nVm1OVDHxP2hwVfbXZrf0S8hES4")}),r=JSON.stringify(a),o=JSON.parse(r);l("6/6: Guardando en la base de datos...");let n=await m(o);n.success?(i(a),l("¬°Notificaciones Activadas!"),alert("¬°Suscripci√≥n exitosa!"),setTimeout(()=>l(""),3e3)):(l(`Error en BD: ${n.error}`),alert(`Error guardando en BD: ${n.error}`))}catch(e){console.error("Error in subscribeToPush:",e),l(`Denegado / Error: ${e.message}`),alert(`Error al suscribir: ${e.message}`)}d(!1)};return e?(0,t.jsxs)("div",{style:{padding:"1rem",borderTop:"1px solid var(--border-color)",marginTop:"auto"},children:[o?(0,t.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--status-ready)"},children:"‚úÖ Notificaciones Activadas"}):(0,t.jsx)("button",{onClick:u,style:{width:"100%",padding:"0.5rem",backgroundColor:"var(--primary)",color:"white",border:"none",borderRadius:"var(--radius-sm)",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:"Activar Alertas (Push)"}),n&&(0,t.jsx)("div",{style:{fontSize:"0.75rem",color:"gray",marginTop:"0.5rem"},children:n})]}):null}function f({initialWorkspaces:e=[],isCollapsed:a=!1,isMobile:l=!1,onToggle:s}){let d=(0,r.usePathname)(),{data:c}=(0,i.useSession)();return(0,t.jsxs)("aside",{className:`${n.default.sidebar} ${a?n.default.collapsed:""} ${l?n.default.mobile:""}`,children:[s&&(0,t.jsx)("button",{className:n.default.toggleBtn,onClick:s,title:a?"Mostrar Men√∫":"Ocultar Men√∫",children:a?"„Äã":"„Ää"}),(0,t.jsxs)("div",{className:n.default.sidebarContent,children:[(0,t.jsxs)("div",{className:n.default.logo,children:[(0,t.jsx)("span",{className:n.default.icon,children:"‚ö°"}),"NextTask"]}),(0,t.jsx)("nav",{className:n.default.nav,children:(0,t.jsxs)("ul",{children:[(0,t.jsx)(o.default,{href:"/",style:{textDecoration:"none"},children:(0,t.jsx)("li",{className:"/"===d?n.default.active:"",children:"Dashboard Global"})}),(0,t.jsx)(o.default,{href:"/my-tasks",style:{textDecoration:"none"},children:(0,t.jsx)("li",{className:"/my-tasks"===d?n.default.active:"",children:"Mis Tareas"})}),(0,t.jsx)(o.default,{href:"/reports",style:{textDecoration:"none"},children:(0,t.jsx)("li",{className:"/reports"===d?n.default.active:"",children:"Reportes"})})]})}),(0,t.jsx)(u,{initialWorkspaces:e}),(0,t.jsx)(p,{}),(0,t.jsxs)("div",{className:n.default.userSection,children:[!a&&c?.user&&(0,t.jsxs)("div",{className:n.default.userInfo,children:[(0,t.jsx)("div",{className:n.default.avatar,children:c.user.name?.charAt(0).toUpperCase()}),(0,t.jsx)("span",{className:n.default.userName,children:c.user.name})]}),(0,t.jsxs)("button",{className:`${n.default.logoutBtn} ${a?n.default.logoutBtnCollapsed:""}`,onClick:()=>(0,i.signOut)({callbackUrl:"/login"}),title:"Cerrar Sessi√≥n",children:["‚éã ",a?"":"Salir"]})]})]})]})}var h=e.i(67874);function b({children:e,initialWorkspaces:o}){let[i,n]=(0,a.useState)(!1),[l,s]=(0,a.useState)(!1),[d,c]=(0,a.useState)(!1),u=(0,r.usePathname)(),m="/login"===u||"/register"===u;return((0,a.useEffect)(()=>{c(!0);let e=()=>{let e=window.innerWidth<=768;s(e),e?n(!0):n(!1)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,a.useEffect)(()=>{l&&!i&&n(!0)},[u]),m)?(0,t.jsx)(t.Fragment,{children:e}):(0,t.jsxs)("div",{className:h.default.layout,children:[d&&l&&!i&&(0,t.jsx)("div",{className:h.default.backdrop,onClick:()=>n(!0)}),(0,t.jsx)(f,{initialWorkspaces:o,isCollapsed:i,isMobile:l,onToggle:()=>n(!i)}),(0,t.jsx)("div",{className:`${h.default.mainContent} ${i?h.default.contentCollapsed:""} ${l?h.default.contentMobile:""}`,children:e})]})}e.s(["default",()=>b],9796)},7594,e=>{e.v({chatHeader:"FloatingChatbot-module__ZJnDPa__chatHeader",chatWindow:"FloatingChatbot-module__ZJnDPa__chatWindow",chatbotWrapper:"FloatingChatbot-module__ZJnDPa__chatbotWrapper",closeBtn:"FloatingChatbot-module__ZJnDPa__closeBtn",fabBtn:"FloatingChatbot-module__ZJnDPa__fabBtn",input:"FloatingChatbot-module__ZJnDPa__input",inputArea:"FloatingChatbot-module__ZJnDPa__inputArea",messagesArea:"FloatingChatbot-module__ZJnDPa__messagesArea",msgAi:"FloatingChatbot-module__ZJnDPa__msgAi",msgUser:"FloatingChatbot-module__ZJnDPa__msgUser",sendBtn:"FloatingChatbot-module__ZJnDPa__sendBtn"})},11769,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(7594),o=e.i(18566),i=e.i(95187);let n=(0,i.createServerReference)("40f7eb3235ad61d3222f3a251f463480ee8dcc84e3",i.callServer,void 0,i.findSourceMapURL,"getOrCreateChatSession"),l=(0,i.createServerReference)("40723cc56224262f28b87c25b6b494ea62369a007e",i.callServer,void 0,i.findSourceMapURL,"getChatHistory"),s=(0,i.createServerReference)("40897aa8b4c0ae0f8aadab3d0c9582d0f8de82be30",i.callServer,void 0,i.findSourceMapURL,"clearChatHistory");function d(){let[e,i]=(0,a.useState)(!1),[d,c]=(0,a.useState)([]),[u,m]=(0,a.useState)(""),[p,f]=(0,a.useState)(!1),[h,b]=(0,a.useState)(null),_=(0,o.usePathname)(),g=(0,o.useRouter)();if("/login"===_||"/register"===_)return null;let v=_&&_.includes("/workspace/")&&_.split("/").pop()||null;(0,a.useEffect)(()=>{let e=!0;return(async()=>{try{let t=await n(v);if(!e)return;b(t.id);let a=await l(t.id);if(!e)return;a&&a.length>0?c(a.map(e=>({role:e.role,text:e.text}))):c([{role:"model",text:"¬°Hola! Soy tu asistente de NextTask impulsado por Gemini. ¬øEn qu√© puedo ayudarte a organizar tu d√≠a?"}])}catch(t){console.error("Failed to load chat history",t),e&&c([{role:"model",text:"¬°Hola! Soy tu asistente de NextTask impulsado por Gemini. ¬øEn qu√© puedo ayudarte a organizar tu d√≠a?"}])}})(),()=>{e=!1}},[v]);let x=async()=>{if(!u.trim())return;let e=[...d,{role:"user",text:u.trim()}];c(e),m(""),f(!0);try{let t=null;v&&(t={workspaceId:v,workspaceName:"Workspace Actual"});let a=e.map(e=>({role:e.role,parts:[{text:e.text}]})),r=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:a,context:t,sessionId:h})}),o=await r.json();o.reply?(c(e=>[...e,{role:"model",text:o.reply}]),o.refreshRequired&&g.refresh()):c(e=>[...e,{role:"model",text:"Lo siento, tuve un problema al procesar eso."}])}catch(e){c(e=>[...e,{role:"model",text:"Error de conexi√≥n temporal."}])}finally{f(!1)}},S=async()=>{if(h){f(!0);try{await s(h),c([{role:"model",text:"¬°Hola! He limpiado nuestra conversaci√≥n. ¬øEn qu√© puedo ayudarte a organizar tu d√≠a?"}])}catch(e){console.error("No se pudo limpiar el chat",e)}finally{f(!1)}}};return"/login"===_||"/register"===_?null:(0,t.jsxs)("div",{className:r.default.chatbotWrapper,children:[e&&(0,t.jsxs)("div",{className:r.default.chatWindow,children:[(0,t.jsxs)("div",{className:r.default.chatHeader,children:[(0,t.jsx)("span",{style:{fontWeight:600},children:"‚ú® Gemini AI"}),(0,t.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,t.jsx)("button",{onClick:S,title:"Limpiar Conversaci√≥n",className:r.default.iconBtn,children:"üóëÔ∏è"}),(0,t.jsx)("button",{onClick:()=>i(!1),className:r.default.closeBtn,children:"√ó"})]})]}),(0,t.jsxs)("div",{className:r.default.messagesArea,children:[d.map((e,a)=>(0,t.jsx)("div",{className:"model"===e.role?r.default.msgAi:r.default.msgUser,children:e.text},a)),p&&(0,t.jsx)("div",{className:r.default.msgAi,children:"Pensando..."})]}),(0,t.jsxs)("div",{className:r.default.inputArea,children:[(0,t.jsx)("input",{type:"text",placeholder:"Preg√∫ntale a Gemini...",value:u,onChange:e=>m(e.target.value),onKeyDown:e=>"Enter"===e.key&&x(),className:r.default.input}),(0,t.jsx)("button",{onClick:x,disabled:p,className:r.default.sendBtn,children:p?"...":"‚û§"})]})]}),!e&&(0,t.jsx)("button",{className:r.default.fabBtn,onClick:()=>i(!0),children:"‚ú® Asistente IA"})]})}e.s(["default",()=>d],11769)},2594,e=>{"use strict";var t=e.i(43476),a=e.i(17255);function r({children:e}){return(0,t.jsx)(a.SessionProvider,{children:e})}e.s(["default",()=>r])}]);